!function(e){e.module("tkmlDamClient.directives",[]),e.module("tkmlDamClient.filters",[]),e.module("tkmlDamClient.services",[]),e.module("tkmlDamClient.config",[]),e.module("tkmlDamClient",["ngResource","builder","custom.components","tkmlDamClient.config","tkmlDamClient.directives","tkmlDamClient.filters","tkmlDamClient.services"])}(angular),function(e){e.module("tkmlDamClient.config").provider("tkmlConfig",["$httpProvider",function(t){var n={apiKey:"",apiHost:""};this.configApi=function(e,o){n.apiHost=e,n.apiKey=o,t.defaults.headers.common.Authorization="Token token="+n.apiKey},this.$get=function(){return e.copy(n)}}])}(angular),function(e){e.module("tkmlDamClient.directives").directive("tkmlAssetForm",["Asset","AssetType","$builder",function(t,n,o){var i=["$scope",function(i){function l(){i.input=[],i.defaultValue={},i.asset={name:null,identifier:null,filename:null,metadata:{}},r()}function r(){i.success=null,i.errors={}}function a(t){var n={};return e.forEach(i.assetDefaults,function(e,t){n[t.toLowerCase()]=e}),t?n[t.toLowerCase()]:n}function s(t){var n=[];if(i.shownDefaults&&e.forEach(i.shownDefaults,function(e){n.push(e.toLowerCase())}),t){var o=n.indexOf(t.toLowerCase());return o>-1?n[o]:void 0}return n}function c(t){return e.isDefined(a(t))}function d(e){return i.shownDefaults&&s(e)}function p(e){var t=["Client Identifier","Position IDs"];return-1===t.indexOf(e)}function u(){e.forEach(o.forms.default,function(t){p(t.label)?e.forEach(a(),function(e,n){n&&!d(n)&&t.label.toLowerCase()==n&&(t.hide=!0)}):t.hide=!0})}function f(e,t){for(var l=o.forms.default.length,r=0;l>r;r++)o.removeFormObject("default",0);n.get({id:e,verbose:!0}).$promise.then(function(e){e.parameters.forEach(function(e){o.insertFormObject("default",e.form_object.index,e.form_object),t&&c(e.name)&&b(e.id,a(e.name))}),i.assetTypeName=e.asset_type.name,u()})}function m(t){e.extend(i.asset,t),e.forEach(t.metadata,function(e){b(e.id,e.value)})}function b(e,t){var n=(t||"").toString();n.length>0&&(i.defaultValue[e]=n,i.asset.metadata[e]=n)}function g(e){t.update({id:e.asset.id},e,y("Asset updated!"),$)}function v(e){t.save({},e,y("Asset saved!"),$)}function h(t,n){m(t),i.errors=[],e.isDefined(n)&&(i.success=n)}function y(t){return i.isSaving=!1,function(n){h(n.asset,t),e.isDefined(i.assetCallback)&&i.assetCallback(n.asset)}}function $(e){i.isSaving=!1,i.success="",i.errors=(e.data||{}).errors}var x=[];l(),i.$watch("asset.identifier",function(e){e&&(i.asset.name=e)}),i.$watch(function(){return i.input.length},function(t){t>0&&e.forEach(i.input,function(t,n){var o=i.$watch(function(){return i.input[n]?i.input[n].value:void 0},function(n){e.isDefined(n)&&(i.asset.metadata[t.id]=n)});x.push(o)})}),i.$watch("assetId",function(e){if(e){r();var n={};t.get({id:i.assetId},function(e){n=e.asset,m(n),f(n.asset_type_id,!1)}).$promise.then(function(){i.assetTypeId=n.asset_type_id})}}),i.$watch("assetTypeId",function(t){t&&(i.assetId||(e.forEach(x,function(e){e()}),l(),f(i.assetTypeId,!0)))}),i.submitButtonText=function(){return i.asset.id?"Update":"Save"},i.submitAssetForm=function(){i.isSaving=!0,i.errors=null;var e={asset_type_id:i.assetTypeId,asset:i.asset};i.asset.id?g(e):v(e)}}];return{restrict:"A",scope:{assetId:"=tkmlAssetId",assetTypeId:"=tkmlAssetTypeId",assetDefaults:"=tkmlAssetDefaults",shownDefaults:"=tkmlShownDefaults",assetCallback:"=tkmlAssetCallback"},template:"<fieldset ng-if='assetTypeId' ng-disabled='isSaving'><form id='asset_form' name='asset_form' ng-submit='submitAssetForm()'><div class='panel panel-danger' ng-if='errors.length > 0'><div class='panel-heading'><h3 class='panel-title'>{{ errors.length }} error(s) prevented this asset from saving.</h3></div><div class='panel-body'><ul class='list-unstyled'><li ng-repeat='error in errors' class='text-danger'>{{ error }}</li></ul></div></div><div class='form-group'><label for='asset_asset_type'>Asset type</label><input class='form-control' type='text' name='asset[asset_type]' ng-model='assetTypeName' disabled></div><div class='form-group'><label class='required' for='asset_identifier'>Identifier (SKU and/or unique element descriptor)</label><input class='form-control' type='text' name='asset[identifier]' ng-model='asset.identifier'></div><div class='form-group ng-hide'><label class='required' for='asset_name'>Name</label><input class='form-control' type='text' name='asset[name]' ng-model='asset.name'></div><div class='form-group'><label class='required' for='asset_filename'>Filename</label><input class='form-control' type='text' name='asset[filename]' ng-model='asset.filename'></div><div class='form-group'><label class='required' for='asset_document'>Document</label><input tkml-file-field type='file' name='asset[document]' ng-model='asset.document'></div><div ng-model='input' fb-form='default' fb-default='defaultValue'></div><div class='alert alert-success' role='alert' ng-if='success'>{{ success }}</div><i class='fa fa-spinner fa-pulse' ng-if='isSaving'></i><div class='form-group'><button type='submit' name='submit' id='asset_form-submit' class='btn btn-danger' ng-disabled='isSaving'>{{ submitButtonText() }}</button></div></form></fieldset>",controller:i}}])}(angular),function(e){e.module("tkmlDamClient.directives").directive("tkmlFileField",function(){var e=function(e,t,n,o){o&&t.bind("change",function(t){e.$apply(function(){e.asset.document=t.target.files[0]})})};return{restrict:"A",require:"?ngModel",link:e}})}(angular),function(){var e;e=function(e,t){var n,o;for(n in e)o=e[n],"$$hashKey"!==n&&(t[n]=o)},angular.module("builder.controller",["builder.provider"]).controller("fbFormObjectEditableController",["$scope","$injector",function(t,n){var o;return o=n.get("$builder"),t.setupScope=function(n){var i;return e(n,t),t.optionsText=n.options.join("\n"),t.$watch("[label, description, placeholder, required, options, type, validations]",function(){return n.label=t.label,n.description=t.description,n.placeholder=t.placeholder,n.required=t.required,n.options=t.options,n.validations=t.validations,n.type=t.type},!0),t.$watch("optionsText",function(e){var n;return t.options=function(){var t,o,i,l;for(i=e.split("\n"),l=[],t=0,o=i.length;o>t;t++)n=i[t],n.length>0&&l.push(n);return l}(),t.inputText=t.options[0]}),i=o.components[n.component],t.validationOptions=i.validationOptions,t.typeOptions=i.typeOptions},t.data={model:null,backup:function(){return this.model={label:t.label,description:t.description,placeholder:t.placeholder,required:t.required,optionsText:t.optionsText,validations:t.validations,type:t.type}},rollback:function(){return this.model?(t.label=this.model.label,t.description=this.model.description,t.placeholder=this.model.placeholder,t.required=this.model.required,t.optionsText=this.model.optionsText,t.validations=this.model.validations,t.type=this.model.type):void 0}}}]).controller("fbComponentsController",["$scope","$injector",function(e,t){var n;return n=t.get("$builder"),e.selectGroup=function(t,o){var i,l,r,a;null!=t&&t.preventDefault(),e.activeGroup=o,e.components=[],r=n.components,a=[];for(l in r)i=r[l],i.group===o&&a.push(e.components.push(i));return a},e.groups=n.groups,e.activeGroup=e.groups[0],e.allComponents=n.components,e.$watch("allComponents",function(){return e.selectGroup(null,e.activeGroup)})}]).controller("fbComponentController",["$scope",function(t){return t.copyObjectToScope=function(n){return e(n,t)}}]).controller("fbFormController",["$scope","$injector",function(e,t){var n,o;return n=t.get("$builder"),o=t.get("$timeout"),null==e.input&&(e.input=[]),e.$watch("form",function(){return e.input.length>e.form.length&&e.input.splice(e.form.length),o(function(){return e.$broadcast(n.broadcastChannel.updateInput)})},!0)}]).controller("fbFormObjectController",["$scope","$injector",function(t,n){var o;return o=n.get("$builder"),t.copyObjectToScope=function(n){return e(n,t)},t.updateInput=function(e){var n;return n={id:t.formObject.id,label:t.formObject.label,value:null!=e?e:""},t.$parent.input.splice(t.$index,1,n)}}])}.call(this),function(){angular.module("custom.components",["builder"]).config(["$builderProvider",function(e){return e.registerComponent("textInput",{index:0,group:"Default",label:"Text Input",description:"description",placeholder:"placeholder",type:"string",required:!1,validations:{regex:"",minLength:"",maxLength:""},validationOptions:["none","number","text","alphanumeric"],thumbnail:'<figure class="form-builder-option">\n  <i class="text-input-icon">Text Input</i>\n  <figcaption class="form-builder-option-title">\n    <h6>Text Input</h6>\n  </figcaption>\n</figure>',template:'<div class="form-element">\n  <label for="{{formName+index}}" class="control-label" ng-class="{required: required}">{{label}}</label>\n  <input type="text" ng-model="inputText" name="asset[metadata][{{id}}]" id="{{id}}" class="form-control" placeholder="{{placeholder}}"/>\n  <p class=\'help-block\'>{{description}}</p>\n  <p class=\'validation-block\'>{{validationString}}</p>\n</div>',popoverTemplate:'<span ng-click="popover.cancel($event)" class=\'popover-close\'>X</span>\n<form>\n    <fieldset class="form-fieldset">\n        <label ng-class="{required: required}">Label</label>\n        <input type=\'text\' ng-model="label" />\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <label>Description</label>\n        <input type=\'text\' ng-model="description" />\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <label>Placeholder</label>\n        <input type=\'text\' ng-model="placeholder" />\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <div ng-if="validationOptions.length > 0">\n            <label>Validation</label>\n            <select ng-model="validations.regex" ng-options="option for option in validationOptions"></select>\n        </div>\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <label class=\'control-label\'>Minimum Length</label>\n        <input type=\'text\' ng-model="validations.minLength" />\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <label>Maximum Length</label>\n        <input type=\'text\' ng-model="validations.maxLength" />\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <div class="checkbox">\n            <label>\n                <input type=\'checkbox\' ng-model="required" />\n                Required\n            </label>\n        </div>\n    </fieldset>\n    <fieldset class="form-fieldset form-actions">\n        <input type=\'submit\' ng-click="popover.save($event)" class=\'button button-primary\' value=\'Save\'/>\n    </fieldset>\n</form>'}),e.registerComponent("textArea",{index:0,group:"Default",label:"Text Area",description:"description",placeholder:"placeholder",type:"string",required:!1,thumbnail:'<figure class="form-builder-option">\n  <i class="textarea-icon">Text Input</i>\n  <figcaption class="form-builder-option-title">\n    <h6>Textarea</h6>\n  </figcaption>\n</figure>',template:'<div class="form-element">\n  <label for="{{formName+index}}" class="control-label" ng-class="{required: required}">{{label}}</label>\n  <textarea type="text" ng-model="inputText" name="asset[metadata][{{id}}]" id="{{id}}" class="form-control" rows=\'6\' placeholder="{{placeholder}}"/>\n  <p class=\'help-block\'>{{description}}</p>\n</div>',popoverTemplate:"<span ng-click=\"popover.cancel($event)\" class='popover-close'>X</span>\n<form>\n    <fieldset class=\"form-fieldset\">\n        <label class='control-label' ng-class=\"{required: required}\">Label</label>\n        <input type='text' ng-model=\"label\" class='form-control'/>\n    </fieldset>\n    <fieldset class=\"form-fieldset\">\n        <label class='control-label'>Description</label>\n        <input type='text' ng-model=\"description\" class='form-control'/>\n    </fieldset>\n    <fieldset class=\"form-fieldset\">\n        <label class='control-label'>Placeholder</label>\n        <input type='text' ng-model=\"placeholder\" class='form-control'/>\n    </fieldset>\n    <fieldset class=\"checkbox form-fieldset\">\n        <label>\n            <input type='checkbox' ng-model=\"required\" />\n            Required</label>\n    </fieldset>\n     <fieldset class=\"form-fieldset form-actions\">\n        <input type='submit' ng-click=\"popover.save($event)\" class='button button-primary' value='Save'/>\n    </fieldset>\n</form>"}),e.registerComponent("checkbox",{index:0,group:"Default",label:"Checkbox",description:"description",placeholder:"placeholder",type:"string",typeOptions:["string","integer","float","date","datetime"],required:!1,options:["value one","value two"],validations:{checkbox:"checkbox"},arrayToText:!0,thumbnail:'<figure class="form-builder-option">\n  <i class="checkbox-icon">Checkbox</i>\n  <figcaption class="form-builder-option-title">\n    <h6>Checkboxes</h6>\n  </figcaption>\n</figure>',template:'<div class="form-element">\n  <label for="{{formName+index}}" class="control-label" ng-class="{required: required}">{{label}}</label>\n  <div class="form-element-columns">\n      <input type=\'hidden\' ng-model="inputText" name="asset[metadata][{{id}}]" id="{{id}}" value="{{inputText}}"/>\n      <div class=\'checkbox checkbox-group\' ng-repeat="item in options track by $index">\n        <label>\n            <input type=\'checkbox\' ng-model="$parent.inputArray[$index]"/>\n            {{item}}\n        </label>\n      </div>\n    </div>\n  <p class=\'help-block\'>{{description}}</p>\n</div>',popoverTemplate:'<span ng-click="popover.cancel($event)" class=\'popover-close\'>X</span>\n<form>\n    <fieldset class="form-fieldset">\n        <div ng-if="typeOptions.length > 0">\n            <label>Type</label>\n            <select ng-model="type" ng-options="option for option in typeOptions"></select>\n        </div>\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <label class=\'control-label\' ng-class="{required: required}">Label</label>\n        <input type=\'text\' ng-model="label" />\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <label class=\'control-label\'>Description</label>\n        <input type=\'text\' ng-model="description" />\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <label class=\'control-label\'>Options</label>\n        <textarea rows="3" ng-model="optionsText"/>\n    </fieldset>\n    <fieldset class="checkbox form-fieldset">\n        <label class="checkbox-group">\n            <input type=\'checkbox\' ng-model="required" />\n            Required\n        </label>\n    </fieldset>\n    <fieldset class=\'form-fieldset form-actions\'>\n        <input type=\'submit\' ng-click="popover.save($event)" class=\'button button-primary\' value=\'Save\'/>\n    </fieldset>\n</form>'}),e.registerComponent("radio",{index:0,group:"Default",label:"Radio",description:"description",placeholder:"placeholder",type:"string",typeOptions:["string","integer","float","date","datetime"],required:!1,options:["value one","value two"],validations:{radio:"radio"},thumbnail:'<figure class="form-builder-option">\n  <i class="radio-button-icon">Radio Button</i>\n  <figcaption class="form-builder-option-title">\n    <h6>Radio Buttons</h6>\n  </figcaption>\n</figure>',template:'<div class="form-element">\n  <label for="{{formName+index}}" class="control-label" ng-class="{required: required}">{{label}}</label>\n    <div class="form-element-columns">\n        <div class=\'radio\' ng-repeat="item in options track by $index">\n          <label><input ng-model="$parent.inputText" name="asset[metadata][{{id}}]" id="{{id}}" value=\'{{item}}\' type=\'radio\'/>\n                  {{item}}\n          </label>\n        </div>\n    </div>\n    <p class=\'help-block\'>{{description}}</p>\n</div>',popoverTemplate:'<span ng-click="popover.cancel($event)" class=\'popover-close\'>X</span>\n<form>\n    <fieldset class="form-fieldset">\n        <div ng-if="typeOptions.length > 0">\n            <label>Type</label>\n            <select ng-model="type" ng-options="option for option in typeOptions"></select>\n        </div>\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <label class=\'control-label\' ng-class="{required: required}">Label</label>\n        <input type=\'text\' ng-model="label" class=\'form-control\'/>\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <label class=\'control-label\'>Description</label>\n        <input type=\'text\' ng-model="description" class=\'form-control\'/>\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <label class=\'control-label\'>Options</label>\n        <textarea class="form-control" rows="3" ng-model="optionsText"/>\n    </fieldset>\n    <fieldset class="form-fieldset form-actions">\n        <input type=\'submit\' ng-click="popover.save($event)" class=\'button button-primary\' value=\'Save\'/>\n    </fieldset>\n</form>'}),e.registerComponent("select",{index:0,group:"Default",label:"Select",description:"description",placeholder:"placeholder",type:"string",typeOptions:["string","integer","float","date","datetime"],required:!1,options:["value one","value two"],validations:{select:"select"},thumbnail:'<figure class="form-builder-option">\n  <i class="select-icon">Select Input</i>\n  <figcaption class="form-builder-option-title">\n    <h6>Select</h6>\n  </figcaption>\n</figure>',template:'<div class="form-element">\n  <label for="{{formName+index}}" class="control-label" ng-class="{required: required}">{{label}}</label>\n  <select ng-options="value for value in options track by value" id="{{id}}"\n    ng-model="inputText" name="asset[metadata][{{id}}]" ng-init="inputText = options[0]"/>\n  <p class=\'help-block\'>{{description}}</p>\n</div>',popoverTemplate:'<span ng-click="popover.cancel($event)" class=\'popover-close\'>X</span>\n<form>\n    <fieldset class="form-fieldset">\n        <div ng-if="typeOptions.length > 0">\n            <label>Type</label>\n            <select ng-model="type" ng-options="option for option in typeOptions"></select>\n        </div>\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <label class=\'control-label\' ng-class="{required: required}">Label</label>\n        <input type=\'text\' ng-model="label" class=\'form-control\'/>\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <label class=\'control-label\'>Description</label>\n        <input type=\'text\' ng-model="description" class=\'form-control\'/>\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <label class=\'control-label\'>Options</label>\n        <textarea class="form-control" rows="3" ng-model="optionsText"/>\n    </fieldset>\n    <fieldset class="form-fieldset form-actions">\n        <input type=\'submit\' ng-click="popover.save($event)" class=\'button button-primary\' value=\'Save\'/>\n    </fieldset>\n</form>'}),e.registerComponent("numberInput",{index:0,group:"Default",label:"Number Input",description:"description",placeholder:"placeholder",type:"integer",typeOptions:["integer","float"],required:!1,validations:{regex:"number"},thumbnail:'<figure class="form-builder-option">\n  <i class="number-icon">Number Input</i>\n  <figcaption class="form-builder-option-title">\n    <h6>Number</h6>\n  </figcaption>\n</figure>',template:'<div class="form-element">\n  <label for="{{formName+index}}" class="control-label" ng-class="{required: required}">{{label}}</label>\n  <input type="text" ng-model="inputText" name="asset[metadata][{{id}}]" id="{{id}}" class="form-control" placeholder="{{placeholder}}"/>\n  <p class=\'help-block\'>{{description}}</p>\n  <p class=\'validation-block\'>{{validationString}}</p>\n</div>',popoverTemplate:'<span ng-click="popover.cancel($event)" class=\'popover-close\'>X</span>\n<form>\n    <fieldset class="form-fieldset">\n        <div ng-if="typeOptions.length > 0">\n            <label>Type</label>\n            <select ng-model="type" ng-options="option for option in typeOptions"></select>\n        </div>\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <label ng-class="{required: required}">Label</label>\n        <input type=\'text\' ng-model="label" />\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <label>Description</label>\n        <input type=\'text\' ng-model="description" />\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <label>Placeholder</label>\n        <input type=\'text\' ng-model="placeholder" />\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <div class="checkbox">\n            <label>\n                <input type=\'checkbox\' ng-model="required" />\n                Required\n            </label>\n        </div>\n    </fieldset>\n    <fieldset class="form-fieldset form-actions">\n        <input type=\'submit\' ng-click="popover.save($event)" class=\'button button-primary\' value=\'Save\'/>\n    </fieldset>\n</form>'}),e.registerComponent("dateInput",{index:0,group:"Default",label:"Date Input",description:"description",placeholder:"m/dd/yyyy",type:"date",required:!1,validations:{regex:"date"},thumbnail:'<figure class="form-builder-option">\n  <i class="date-icon">Date Input</i>\n  <figcaption class="form-builder-option-title">\n    <h6>Date</h6>\n  </figcaption>\n</figure>',template:'<div class="form-element">\n  <label for="{{formName+index}}" class="control-label" ng-class="{required: required}">{{label}}</label>\n  <input type="text" ng-model="inputText" name="asset[metadata][{{id}}]" id="{{id}}" class="form-control datepicker" placeholder="{{placeholder}}"/>\n  <p class=\'help-block\'>{{description}}</p>\n  <p class=\'validation-block\'>{{validationString}}</p>\n</div>',popoverTemplate:'<span ng-click="popover.cancel($event)" class=\'popover-close\'>X</span>\n<form>\n    <fieldset class="form-fieldset">\n        <label ng-class="{required: required}">Label</label>\n        <input type=\'text\' ng-model="label" />\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <label>Description</label>\n        <input type=\'text\' ng-model="description" />\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <div class="checkbox">\n            <label>\n                <input type=\'checkbox\' ng-model="required" />\n                Required\n            </label>\n        </div>\n    </fieldset>\n    <fieldset class="form-fieldset form-actions">\n        <input type=\'submit\' ng-click="popover.save($event)" class=\'button button-primary\' value=\'Save\'/>\n    </fieldset>\n</form>'}),e.registerComponent("dateTimeInput",{index:0,group:"Default",label:"DateTime Input",description:"description",placeholder:"m/dd/yyyy h:mm am/pm",type:"datetime",required:!1,validations:{regex:"datetime"},thumbnail:'<figure class="form-builder-option">\n  <i class="date-time-icon">DateTime Input</i>\n  <figcaption class="form-builder-option-title">\n    <h6>DateTime</h6>\n  </figcaption>\n</figure>',template:'<div class="form-element">\n  <label for="{{formName+index}}" class="control-label" ng-class="{required: required}">{{label}}</label>\n  <input type="text" ng-model="inputText" name="asset[metadata][{{id}}]" id="{{id}}" class="form-control datetimepicker" placeholder="{{placeholder}}"/>\n  <p class=\'help-block\'>{{description}}</p>\n  <p class=\'validation-block\'>{{validationString}}</p>\n</div>',popoverTemplate:'<span ng-click="popover.cancel($event)" class=\'popover-close\'>X</span>\n<form>\n    <fieldset class="form-fieldset">\n        <label ng-class="{required: required}">Label</label>\n        <input type=\'text\' ng-model="label" />\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <label>Description</label>\n        <input type=\'text\' ng-model="description" />\n    </fieldset>\n    <fieldset class="form-fieldset">\n        <div class="checkbox">\n            <label>\n                <input type=\'checkbox\' ng-model="required" />\n                Required\n            </label>\n        </div>\n    </fieldset>\n    <fieldset class="form-fieldset form-actions">\n        <input type=\'submit\' ng-click="popover.save($event)" class=\'button button-primary\' value=\'Save\'/>\n    </fieldset>\n</form>'})}])}.call(this),function(){angular.module("builder.directive",["builder.provider","builder.controller","builder.drag"]).directive("fbBuilder",["$injector",function(e){var t,n;return t=e.get("$builder"),n=e.get("$drag"),{restrict:"A",scope:{fbBuilder:"="},template:'<div>\n    <div class="form-builder-no-elements" ng-show="formObjects.length == 0">\n        <i class="no-elements-icon"></i>\n        <h4>Getting Started</h4>\n        <p>Drag and drop form elements from the<br>right to start building your new asset type.</p>\n    </div>\n    <div class=\'fb-form-object-editable\' ng-repeat="object in formObjects | orderBy:\'\'" fb-form-object-editable="object">\n    </div>\n</div>',link:function(e,o,i){var l,r,a;return e.formName=i.fbBuilder,null==(l=t.forms)[a=e.formName]&&(l[a]=[]),e.formObjects=t.forms[e.formName],r=!0,$(o).addClass("fb-builder"),n.droppable($(o),{move:function(e){var t,n,i,l,a,s,c,d,p,u,f;if(r&&($("div.fb-form-object-editable").popover("hide"),r=!1),i=$(o).find(".fb-form-object-editable:not(.empty,.dragging)"),0===i.length)return 0===$(o).find(".fb-form-object-editable.empty").length&&$(o).find(">div:first").append($("<div class='fb-form-object-editable empty'></div>")),void 0;for(p=[],p.push(-1e3),s=a=0,u=i.length;u>a;s=a+=1)n=$(i[s]),d=n.offset(),l=n.height(),p.push(d.top+l/2);for(p.push(p[p.length-1]+1e3),s=c=1,f=p.length;f>c;s=c+=1)if(e.pageY>p[s-1]&&e.pageY<=p[s]){$(o).find(".empty").remove(),t=$("<div class='fb-form-object-editable empty'></div>"),s-1<i.length?t.insertBefore($(i[s-1])):t.insertAfter($(i[s-2]));break}},out:function(){return r&&($("div.fb-form-object-editable").popover("hide"),r=!1),$(o).find(".empty").remove()},up:function(l,a,s){var c,d,p;return r=!0,n.isMouseMoved()?(a||"drag"!==s.mode?a&&("mirror"===s.mode&&t.insertFormObject(e.formName,$(o).find(".empty").index(".fb-form-object-editable"),{component:s.object.componentName}),"drag"===s.mode&&(p=s.object.formObject.index,d=$(o).find(".empty").index(".fb-form-object-editable"),d>p&&d--,t.updateFormObjectIndex(e.formName,p,d))):(c=s.object.formObject,c.editable&&t.removeFormObject(i.fbBuilder,c.index)),$(o).find(".empty").remove()):($(o).find(".empty").remove(),void 0)}})}}}]).directive("fbFormObjectEditable",["$injector",function(e){var t,n,o;return t=e.get("$builder"),o=e.get("$drag"),n=e.get("$compile"),{restrict:"A",controller:"fbFormObjectEditableController",scope:{formObject:"=fbFormObjectEditable"},link:function(e,i){var l;return e.inputArray=[],e.$component=t.components[e.formObject.component],e.setupScope(e.formObject),e.$watch("$component.template",function(t){var o;if(t)return o=n(t)(e),$(i).html(o)}),$(i).on("click",function(){return!1}),o.draggable($(i),{object:{formObject:e.formObject}}),e.formObject.editable?(l={},e.$watch("$component.popoverTemplate",function(o){return o?($(i).removeClass(l.id),l={id:"fb-"+Math.random().toString().substr(2),isClickedSave:!1,view:null,html:o},l.html=$(l.html).addClass(l.id),l.view=n(l.html)(e),$(i).addClass(l.id),$(i).popover({html:!0,title:e.$component.label,content:l.view,container:"body",placement:t.config.popoverPlacement})):void 0}),e.popover={save:function(e){e.preventDefault(),l.isClickedSave=!0,$(i).popover("hide")},remove:function(n){n.preventDefault(),t.removeFormObject(e.$parent.formName,e.$parent.$index),$(i).popover("hide")},shown:function(){return e.data.backup(),l.isClickedSave=!1},cancel:function(t){e.data.rollback(),t&&(t.preventDefault(),$(i).popover("hide"))}},$(i).on("show.bs.popover",function(){var e,t,n;return o.isMouseMoved()?!1:($("div.fb-form-object-editable:not(."+l.id+")").popover("hide"),e=$("form."+l.id).closest(".popover"),e.length>0?(t=$(i).offset().top+$(i).height()/2,n=t-e.height()/2,e.css({position:"absolute",top:n}),e.show(),setTimeout(function(){return e.addClass("in"),$(i).triggerHandler("shown.bs.popover")},0),!1):void 0)}),$(i).on("shown.bs.popover",function(){$(".popover ."+l.id+" input:first").select(),e.$apply(function(){return e.popover.shown()})}),$(i).on("hide.bs.popover",function(){var t;return t=$("form."+l.id).closest(".popover"),l.isClickedSave||(e.$$phase||e.$root.$$phase?e.popover.cancel():e.$apply(function(){return e.popover.cancel()})),t.removeClass("in"),setTimeout(function(){return t.hide()},300),!1})):void 0}}}]).directive("fbComponents",function(){return{restrict:"A",template:'<ul ng-if="groups.length > 1" class="nav nav-tabs nav-justified">\n    <li ng-repeat="group in groups" ng-class="{active:activeGroup==group}">\n        <a href=\'#\' ng-click="selectGroup($event, group)">{{group}}</a>\n    </li>\n</ul>\n<div class=\'fb-component\' ng-repeat="component in components" fb-component="component">\n</div>',controller:"fbComponentsController"}}).directive("fbComponent",["$injector",function(e){var t,n,o;return t=e.get("$builder"),o=e.get("$drag"),n=e.get("$compile"),{restrict:"A",scope:{component:"=fbComponent"},controller:"fbComponentController",link:function(e,t){return e.copyObjectToScope(e.component),o.draggable($(t),{mode:"mirror",defer:!1,object:{componentName:e.component.name}}),e.component.thumbnail?$(t).html(e.component.thumbnail):e.$watch("component.template",function(o){var i;if(o)return i=n(o)(e),$(t).html(i)})}}}]).directive("fbForm",["$injector",function(e){return{restrict:"A",require:"ngModel",scope:{formName:"@fbForm",input:"=ngModel","default":"=fbDefault"},template:'<div class=\'fb-form-object\' ng-repeat="object in form" fb-form-object="object"></div>',controller:"fbFormController",link:function(t){var n,o,i;return n=e.get("$builder"),null==(o=n.forms)[i=t.formName]&&(o[i]=[]),t.form=n.forms[t.formName]}}}]).directive("fbFormObject",["$injector",function(e){var t,n,o;return t=e.get("$builder"),n=e.get("$compile"),o=e.get("$parse"),{restrict:"A",controller:"fbFormObjectController",link:function(e,i,l){return e.formObject=o(l.fbFormObject)(e),e.$component=t.components[e.formObject.component],e.$on(t.broadcastChannel.updateInput,function(){return e.updateInput(e.inputText)}),e.$component.arrayToText&&(e.inputArray=[],e.$watch("inputArray",function(t,n){var o,i,l;if(t!==n){o=[];for(i in e.inputArray)e.inputArray[i]&&o.push(null!=(l=e.options[i])?l:e.inputArray[i]);return e.inputText=o.join(", ")}},!0)),e.$watch("inputText",function(){return e.updateInput(e.inputText)}),e.$watch(l.fbFormObject,function(){return e.copyObjectToScope(e.formObject)},!0),e.$watch("$component.template",function(t){var o,l,r;if(t)return l=$(t),o=l.find("[ng-model='inputText']"),r=n(l)(e),$(i).html(r)}),!e.$component.arrayToText&&e.formObject.options.length>0&&(e.inputText=e.formObject.options[0]),e.$watch("hide",function(e){e&&i.addClass("ng-hide")}),e.$watch("default['"+e.formObject.id+"']",function(t){var n,o,i,l,r,a;if(t){for(e.inputText=t,e.inputArray=[],l=e.inputText.split(", "),r=[],n=0,i=l.length;i>n;n++)a=l[n],o=e.options.indexOf(a),r.push(e.inputArray[o]=!0);return r}})}}}])}.call(this),function(){angular.module("builder.drag",[]).provider("$drag",function(){var e,t,n;e=null,t=null,this.data={draggables:{},droppables:{}},this.mouseMoved=!1,this.isMouseMoved=function(e){return function(){return e.mouseMoved}}(this),this.hooks={down:{},move:{},up:{}},this.eventMouseMove=function(){},this.eventMouseUp=function(){},$(function(e){return function(){return $(document).on("mousedown",function(t){var n,o,i;e.mouseMoved=!1,i=e.hooks.down;for(o in i)n=i[o],n(t)}),$(document).on("mousemove",function(t){var n,o,i;e.mouseMoved=!0,i=e.hooks.move;for(o in i)n=i[o],n(t)}),$(document).on("mouseup",function(t){var n,o,i;i=e.hooks.up;for(o in i)n=i[o],n(t)})}}(this)),this.currentId=0,this.getNewId=function(e){return function(){return""+e.currentId++}}(this),this.setupEasing=function(){return jQuery.extend(jQuery.easing,{easeOutQuad:function(e,t,n,o,i){return-o*(t/=i)*(t-2)+n}})},this.setupProviders=function(n){return e=n,t=e.get("$rootScope")},this.isHover=function(){return function(e,t){var n,o,i,l,r;
return o=e.offset(),i=t.offset(),l={width:e.width(),height:e.height()},r={width:t.width(),height:t.height()},n={x:!1,y:!1},n.x=o.left>i.left&&o.left<i.left+r.width,n.x=n.x||o.left+l.width>i.left&&o.left+l.width<i.left+r.width,n?(n.y=o.top>i.top&&o.top<i.top+r.height,n.y=n.y||o.top+l.height>i.top&&o.top+l.height<i.top+r.height,n.x&&n.y):!1}}(this),n=function(e,t){return setTimeout(function(){return t()},e)},this.autoScroll={up:!1,down:!1,scrolling:!1,scroll:function(e){return function(){return e.autoScroll.scrolling=!0,e.autoScroll.up?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()-50},100,"easeOutQuad"),n(100,function(){return e.autoScroll.scroll()})):e.autoScroll.down?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()+50},100,"easeOutQuad"),n(100,function(){return e.autoScroll.scroll()})):e.autoScroll.scrolling=!1}}(this),start:function(e){return function(t){if(t.clientY<50){if(e.autoScroll.up=!0,e.autoScroll.down=!1,!e.autoScroll.scrolling)return e.autoScroll.scroll()}else{if(!(t.clientY>$(window).innerHeight()-50))return e.autoScroll.up=!1,e.autoScroll.down=!1;if(e.autoScroll.up=!1,e.autoScroll.down=!0,!e.autoScroll.scrolling)return e.autoScroll.scroll()}}}(this),stop:function(e){return function(){return e.autoScroll.up=!1,e.autoScroll.down=!1}}(this)},this.dragMirrorMode=function(e){return function(t,n,o){var i;return null==n&&(n=!0),i={id:e.getNewId(),mode:"mirror",maternal:t[0],element:null,object:o},t.on("mousedown",function(o){var l;return o.preventDefault(),l=t.clone(),i.element=l[0],l.addClass("fb-draggable form-horizontal prepare-dragging"),e.hooks.move.drag=function(n,o){var r,a,s,c;if(!l.hasClass("prepare-dragging")||(l.css({width:t.width(),height:t.height()}),l.removeClass("prepare-dragging"),l.addClass("dragging"),!o)){l.offset({left:n.pageX-l.width()/2,top:n.pageY-l.height()/2}),e.autoScroll.start(n),s=e.data.droppables,c=[];for(a in s)r=s[a],e.isHover(l,$(r.element))?c.push(r.move(n,i)):c.push(r.out(n,i));return c}},e.hooks.up.drag=function(t){var n,o,r,a;a=e.data.droppables;for(o in a)n=a[o],r=e.isHover(l,$(n.element)),n.up(t,r,i);return delete e.hooks.move.drag,delete e.hooks.up.drag,i.element=null,l.remove(),e.autoScroll.stop()},$("body").append(l),n?void 0:e.hooks.move.drag(o,n)}),i}}(this),this.dragDragMode=function(e){return function(t,n,o){var i;return null==n&&(n=!0),i={id:e.getNewId(),mode:"drag",maternal:null,element:t[0],object:o},t.addClass("fb-draggable"),t.on("mousedown",function(o){return o.preventDefault(),t.hasClass("dragging")?void 0:(t.addClass("prepare-dragging"),e.hooks.move.drag=function(n,o){var l,r,a;if(!t.hasClass("prepare-dragging")||(t.css({width:t.width(),height:t.height()}),t.removeClass("prepare-dragging"),t.addClass("dragging"),!o)){t.offset({left:n.pageX-t.width()/2,top:n.pageY-t.height()/2}),e.autoScroll.start(n),a=e.data.droppables;for(r in a)l=a[r],e.isHover(t,$(l.element))?l.move(n,i):l.out(n,i)}},e.hooks.up.drag=function(n){var o,l,r,a;a=e.data.droppables;for(l in a)o=a[l],r=e.isHover(t,$(o.element)),o.up(n,r,i);return delete e.hooks.move.drag,delete e.hooks.up.drag,t.css({width:"",height:"",left:"",top:""}),t.removeClass("dragging defer-dragging"),e.autoScroll.stop()},n?void 0:e.hooks.move.drag(o,n))}),i}}(this),this.dropMode=function(e){return function(n,o){var i;return i={id:e.getNewId(),element:n[0],move:function(e,n){return t.$apply(function(){return"function"==typeof o.move?o.move(e,n):void 0})},up:function(e,n,i){return t.$apply(function(){return"function"==typeof o.up?o.up(e,n,i):void 0})},out:function(e,n){return t.$apply(function(){return"function"==typeof o.out?o.out(e,n):void 0})}}}}(this),this.draggable=function(e){return function(t,n){var o,i,l,r,a,s,c;if(null==n&&(n={}),c=[],"mirror"===n.mode)for(l=0,a=t.length;a>l;l++)i=t[l],o=e.dragMirrorMode($(i),n.defer,n.object),c.push(o.id),e.data.draggables[o.id]=o;else for(r=0,s=t.length;s>r;r++)i=t[r],o=e.dragDragMode($(i),n.defer,n.object),c.push(o.id),e.data.draggables[o.id]=o;return c}}(this),this.droppable=function(e){return function(t,n){var o,i,l,r,a;for(null==n&&(n={}),a=[],l=0,r=t.length;r>l;l++)i=t[l],o=e.dropMode($(i),n),a.push(o),e.data.droppables[o.id]=o;return a}}(this),this.get=function(e){return this.setupEasing(),this.setupProviders(e),{isMouseMoved:this.isMouseMoved,data:this.data,draggable:this.draggable,droppable:this.droppable}},this.get.$inject=["$injector"],this.$get=this.get})}.call(this),function(){angular.module("builder",["builder.directive"])}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("builder.provider",[]).provider("$builder",function(){var t,n,o;n=null,t=null,o=null,this.config={popoverPlacement:"right"},this.components={},this.groups=[],this.broadcastChannel={updateInput:"$updateInput"},this.forms={"default":[]},this.convertComponent=function(e,t){var n,o,i,l,r,a,s,c,d,p,u,f,m,b,g;return g={name:e,index:null!=(n=t.index)?n:0,group:null!=(o=t.group)?o:"Default",label:null!=(s=t.label)?s:"",description:null!=(c=t.description)?c:"",placeholder:null!=(d=t.placeholder)?d:"",editable:null!=(p=t.editable)?p:!0,required:null!=(u=t.required)?u:!1,validations:null!=(f=t.validations)?f:{},validationOptions:null!=(m=t.validationOptions)?m:[],type:null!=(b=t.type)?b:"",typeOptions:null!=(i=t.typeOptions)?i:[],options:null!=(l=t.options)?l:[],arrayToText:null!=(r=t.arrayToText)?r:!1,template:t.template,templateUrl:t.templateUrl,popoverTemplate:t.popoverTemplate,popoverTemplateUrl:t.popoverTemplateUrl,thumbnail:null!=(a=t.thumbnail)?a:""},g.template||g.templateUrl||console.error("The template is empty."),g.popoverTemplate||g.popoverTemplateUrl||console.error("The popoverTemplate is empty."),g},this.convertFormObject=function(e,t){var n,o,i,l,r,a,s,c,d,p,u;if(null==t&&(t={}),n=this.components[t.component],null==n)throw"The component "+t.component+" was not registered.";return u={id:t.id,index:t.index,component:t.component,editable:null!=(o=t.editable)?o:n.editable,index:null!=(i=t.index)?i:0,label:null!=(l=t.label)?l:n.label,description:null!=(r=t.description)?r:n.description,placeholder:null!=(a=t.placeholder)?a:n.placeholder,options:null!=(s=t.options)?s:n.options,required:null!=(c=t.required)?c:n.required,validations:null!=(d=t.validations)?d:n.validations,type:null!=(p=t.type)?p:n.type}},this.reindexFormObject=function(e){return function(t){var n,o,i,l;for(n=e.forms[t],i=o=0,l=n.length;l>o;i=o+=1)n[i].index=i}}(this),this.setupProviders=function(){return function(e){return n=e,t=n.get("$http"),o=n.get("$templateCache")}}(this),this.loadTemplate=function(e){return null==e.template&&t.get(e.templateUrl,{cache:o}).success(function(t){return e.template=t}),null==e.popoverTemplate?t.get(e.popoverTemplateUrl,{cache:o}).success(function(t){return e.popoverTemplate=t}):void 0},this.registerComponent=function(t){return function(o,i){var l,r;null==i&&(i={}),null==t.components[o]?(l=t.convertComponent(o,i),t.components[o]=l,null!=n&&t.loadTemplate(l),r=l.group,e.call(t.groups,r)<0&&t.groups.push(l.group)):console.error("The component "+o+" was registered.")}}(this),this.addFormObject=function(e){return function(t,n){var o;return null==n&&(n={}),null==(o=e.forms)[t]&&(o[t]=[]),e.insertFormObject(t,e.forms[t].length,n)}}(this),this.insertFormObject=function(e){return function(t,n,o){var i;return null==o&&(o={}),null==(i=e.forms)[t]&&(i[t]=[]),n>e.forms[t].length?n=e.forms[t].length:0>n&&(n=0),e.forms[t].splice(n,0,e.convertFormObject(t,o)),e.reindexFormObject(t),e.forms[t][n]}}(this),this.removeFormObject=function(e){return function(t,n){var o;return o=e.forms[t],o.splice(n,1),e.reindexFormObject(t)}}(this),this.updateFormObjectIndex=function(e){return function(t,n,o){var i,l;if(n!==o)return l=e.forms[t],i=l.splice(n,1)[0],l.splice(o,0,i),e.reindexFormObject(t)}}(this),this.$get=["$injector",function(e){return function(t){var n,o,i;e.setupProviders(t),i=e.components;for(o in i)n=i[o],e.loadTemplate(n);return{config:e.config,components:e.components,groups:e.groups,forms:e.forms,broadcastChannel:e.broadcastChannel,registerComponent:e.registerComponent,addFormObject:e.addFormObject,insertFormObject:e.insertFormObject,removeFormObject:e.removeFormObject,updateFormObjectIndex:e.updateFormObjectIndex}}}(this)]})}.call(this),function(){angular.module("tkmlDamClient.services").factory("Asset",["$resource","tkmlConfig","Util",function(e,t,n){var o=e(t.apiHost+"/assets/:id",{id:"@id"},{update:{method:"PUT",transformRequest:angular.identity,headers:{"Content-Type":void 0}},save:{method:"POST",transformRequest:angular.identity,headers:{"Content-Type":void 0}},byAssetType:{url:t.apiHost+"/assets/search",method:"POST"}}),i=function(e,t,i,l){return o.save(e,n.objectToFormData(t),i,l)},l=function(e,t,i,l){return o.update(e,n.objectToFormData(t),i,l)},r=function(e,t,n){return o.byAssetType({},{search:{asset_type_id:e}},t,n)};return{get:o.get,update:l,save:i,byAssetType:r}}])}(),function(){angular.module("tkmlDamClient.services").factory("AssetType",["$resource","tkmlConfig",function(e,t){return e(t.apiHost+"/asset_types/:id",{id:"@id",verbose:!0})}])}(),function(){angular.module("tkmlDamClient.services").factory("Util",function(){var e=function(t,n,o){var i,l=n||new FormData;for(var r in t)t.hasOwnProperty(r)&&(i=o?o+"["+r+"]":r,"object"!=typeof t[r]||t[r]instanceof File?l.append(i,t[r]):e(t[r],l,i));return l};return{objectToFormData:e}})}();
